<!DOCTYPE html>
<html lang="ja-JP">
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <link rel="icon" type="image/x-icon" href="https://github.com/favicon.ico" />
    <link rel="stylesheet" type="text/css" href="/style.css" media="all" />
    <link rel="alternate" type="application/rss+xml" title="notions:iaarchiver - feed" href="/index.xml" />
    <title>notions:iaarchiver</title>
    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-42298279-1', 'iaarchiver.github.io');
      ga('send', 'pageview');
    </script>
</head>
  <body>
    <!-- .sidebar -->
    <div class="sidebar">
      <ul class="sidebar-nav">
        <li><a class="home-button"><span class="websymbolsliga icon alignleft"></span></a></li>
        <li><a class="search-button"><span class="websymbolsliga icon search"></span></a></li>
        <li><a class="show-archive"><span class="websymbolsliga icon tag"></span></a></li>
        <li><a class="hide-button"><span class="websymbolsliga icon closeoutline"></span></a></li>
      </ul>
      <input id="sidebar-search" placeholder=" search keywords..." />
      <hr>
      <ul class="sidebar-list">
      
        <li>
          <a href="/posts/2013-07-08-1730.html">
            Ubuntuでmpdのセットアップ
            <span class="date">2013-07-08 17:30</span>
            <span class="tag">mpd,ubuntu</span>
          </a>
        </li>
      
        <li>
          <a href="/posts/2013-07-08-2117.html">
            grunt-contrib-copyでのパス指定
            <span class="date">2013-07-08 21:17</span>
            <span class="tag">grunt,js</span>
          </a>
        </li>
      
        <li>
          <a href="/posts/2013-07-09-0731.html">
            GuitarPro6を64bit環境にインストールする
            <span class="date">2013-07-09 07:31</span>
            <span class="tag">guitarpro,ubuntu</span>
          </a>
        </li>
      
        <li>
          <a href="/posts/2013-07-09-1703.html">
            yacreader（のソースコード）をいじる
            <span class="date">2013-07-09 17:03</span>
            <span class="tag">ubuntu,yacreader</span>
          </a>
        </li>
      
        <li>
          <a href="/posts/2013-07-11-2000.html">
            Ubuntu13.04インストールおぼえがき
            <span class="date">2013-07-11 20:00</span>
            <span class="tag">ubuntu</span>
          </a>
        </li>
      
        <li>
          <a href="/posts/2013-07-11-2152.html">
            Ubuntu13.04でTimeCapsuleをマウントする
            <span class="date">2013-07-11 21:52</span>
            <span class="tag">ubuntu,timecapsule</span>
          </a>
        </li>
      
        <li>
          <a href="/posts/2013-07-29-0152.html">
            LinuxからDayOneの読み書きを行う
            <span class="date">2013-07-29 01:52</span>
            <span class="tag">dayone,jrnl</span>
          </a>
        </li>
      
        <li>
          <a href="/posts/2014-06-27-1125.html">
            Info.plistにLSBackgroundOnlyを設定する
            <span class="date">2014-06-27 11:25</span>
            <span class="tag">mac</span>
          </a>
        </li>
      
        <li>
          <a href="/posts/2014-07-01-2140.html">
            特定のアプリのみ終了時にウインドウを閉じる
            <span class="date">2014-07-01 21:40</span>
            <span class="tag">mac</span>
          </a>
        </li>
      
        <li>
          <a href="/posts/2014-07-01-2205.html">
            コマンドを指定してTerminal.appを実行する
            <span class="date">2014-07-01 22:05</span>
            <span class="tag">mac,shell</span>
          </a>
        </li>
      
        <li>
          <a href="/posts/2014-07-01-2217.html">
            シンボリックリンクのオリジナルのパスを取得する
            <span class="date">2014-07-01 22:17</span>
            <span class="tag">shell</span>
          </a>
        </li>
      
        <li>
          <a href="/posts/2014-07-01-2221.html">
            Ubuntu上のVMPlayer使用時にsynergysが落ちる
            <span class="date">2014-07-01 22:21</span>
            <span class="tag">synergy,vmplayer,ubuntu</span>
          </a>
        </li>
      
        <li>
          <a href="/posts/2014-07-01-2230.html">
            tmuxでペイン分割したらCWDを維持してくれない
            <span class="date">2014-07-01 22:30</span>
            <span class="tag">tmux</span>
          </a>
        </li>
      
        <li>
          <a href="/posts/2014-07-01-2231.html">
            vimでshell実行後のEnterを押してくださいというプロンプトを消す
            <span class="date">2014-07-01 22:31</span>
            <span class="tag">vim</span>
          </a>
        </li>
      
      </ul>
    </div>
    <!-- [END] .sidebar -->

    <!-- .wrapper -->
    <div class="wrapper" style="height:100%">
    <!-- .logo -->
    <div class="logo">notions :: iaarchiver</div>
    <!-- [END] .logo -->
    <div class="post">
  <div class="post-info">
  <h1><a href="/posts/2013-07-08-1730.html">Ubuntuでmpdのセットアップ</a></h1>
  <span class="date">July 8th 2013</span>
  <span class="author"></span>
  <hr>
  </div>
  <div class="post-content">
    <p>Ubuntuでmpdを利用する際にいくつか詰まるところがあったのでメモします．
運用方法は，Ubuntu起動時にユーザ設定を読み込んでmpdを立ち上げておき，同Ubuntuのsonataで聞く，もしくはローカルネットワークにあるデバイスで聞く，という方法です．</p>
<h2 id="-">まずはなによりインストール</h2>
<pre><code>    $ su<span class="operator"><span class="keyword">do</span> apt-<span class="keyword">get</span> install mpd sonata</code></pre>
<p>必要ならば<code>mpc</code>も合わせてインストールしておきます．</p>
<h2 id="-mpdconf-"><code>~/.mpdconf</code>を以下の例のように設定．</h2>
<pre><code>    <span class="title">port</span> <span class="string">"6600"</span>
    music_directory <span class="string">"~/Music/"</span>
    playlist_directory <span class="string">"~/.mpd/playlists"</span>
    db_file <span class="string">"~/.mpd/mpd.db"</span>
    log_file <span class="string">"~/.mpd/mpd.log"</span>
    audio_output {
    <span class="title">type</span> <span class="string">"pulse"</span>
    name <span class="string">"MPD"</span>
    }</code></pre>
<p><code>audio_output</code>はメディアサーバとして運用するなど特定の条件下で無い限り，<code>pulse</code>を選択するほうが良いです．</p>
<h2 id="mpd-">mpdを起動，そしてエラーメッセージ</h2>
<pre><code>    $ mpd
    Failed <span class="keyword">to</span> bind <span class="keyword">to</span> '[::]:<span class="number">6600</span>': Address already <span class="keyword">in</span> <span class="keyword">use</span></code></pre>
<p>多くの場合このエラーメッセージが表示されます．（出ない場合でも再起動後に遭遇するかもしれません．）</p>
<p>検索するとこのエラーの解決法について多くのスレッドが見つかりますが，詰まる人が多い理由は以下２つが原因と考えられます．</p>
<ul>
<li>エラーメッセージの通りに起動自体に失敗しているのか，設定の読み込みに失敗しているだけなのかわかりにくい．</li>
<li>mpdの起動に成功しても（別のことが原因で）似たようなエラーメッセージが表示される．</li>
</ul>
<p>...要するに紛らわしいという話です．</p>
<ol>
<li><h3 id="sonata-mpd-">sonataでmpdをちゃんと起動できているか確認する</h3>
<p>sonataを起動し，コンテクストメニューからPreference画面を開いて以下のように設定します．<br><img src="/img/sonata.jpg" alt="sonata"><br>Portは<code>~/.mpdconf</code>で指定したものと同じ値を入力します．また，外部のデバイスから聞く場合はHostをmpdを走らせているマシンのローカルIPアドレスを指定する必要があります．ユーザ設定がきちんと読み込まれていればmpd起動の瞬間に，sonataのLibraryタブに<code>~/.mpdconf</code>で指定したフォルダ内の音楽ファイルが表示されます．</p>
</li>
<li><h3 id="-etc-init-d-mpd-"><code>/etc/init.d/mpd</code>がデーモンとして実行されているかどうか確認する</h3>
<p>mpdをインストールすると<code>/etc/init.d/mpd</code>が作成されて，起動時にスーパーユーザが
デーモンとしてmpdを実行しています．そしてこのときユーザ設定（<code>~/.mpdconf</code>）ではなく管理者設定（<code>/etc/mpd.conf</code>）のみが読み込まれるため，このままではsonataを起動してもLibraryタブに先ほど指定した音楽ファイルが表示されません．
このときは以下を実行してユーザ権限でmpdを再起動させます．</p>
<pre><code> <span class="char">$ </span>sudo service mpd stop
 # もしくは <span class="char">$ </span>sudo /etc/init.d/mpd stop
 <span class="char">$ </span>mpd
 <span class="method">listen:</span> bind to <span class="string">'0.0.0.0:6600'</span> <span class="method">failed:</span> <span class="class">Address</span> already in use (continuing anyway, because binding to <span class="string">'[::]:6600'</span> succeeded)</code></pre>
<p>さきほどと似たようなエラーメッセージが出てはいますが，sonataを起動してLibraryタブに指定した音楽フォルダの中身が反映されている場合，mpdは無事起動しています．</p>
<blockquote>
<p>このエラーメッセージは，ipv6でのバインドを試行して失敗したこと原因のようです．その後にIPv4でバインドに成功しているため問題はありませんが，このメッセージを消したい場合，<code>~/.mpdconf</code>に以下の設定を加えてIPv4でのバインドを指定してやります．<br> 参考：<a href="https://wiki.archlinux.org/index.php/Music_Player_Daemon/Troubleshooting">https://wiki.archlinux.org/index.php/Music_Player_Daemon/Troubleshooting</a></p>
<pre><code> <span class="title">bind_to_address</span> <span class="string">"127.0.0.1"</span></code></pre>
</blockquote>
</li>
<li><h3 id="-mpd-">起動時にスーパーユーザがmpdを起動させないようにする</h3>
<p>起動時にmpdをユーザ設定を読み込んだ上で起動するためには，まずスーパーユーザがmpdを起動させないようにする必要があります．これは<code>/etc/mpd.conf</code>にユーザ設定を直接書いてしまったり，<code>/etc/init.d/mpd</code>をリネームもしくは削除してしまうことで実現できてしまいますが，あまり望ましい方法ではありません．<code>/etc/init.d</code>に登録されながらも自動起動をオフするには以下のようにします</p>
<pre><code> su<span class="operator"><span class="keyword">do</span> <span class="keyword">update</span>-rc.d mpd disable</code></pre>
<p>オンにしたい場合は<code>disable</code>を<code>enable</code>に変えて実行します．</p>
</li>
</ol>
<p>これで自動起動がオフにできたら，DashメニューからStartupApplicationにmpdコマンドを追加することで，ログイン時にユーザ設定を読み込んだ状態でmpdを起動してくれます．</p>

  </div>

  <div class="navigation">
      
        <span class="newer"><a href="/posts/2013-07-08-2117.html">&#8672;&nbsp;newer</a></span>
      
      
    </div>
  <div class="comments">
    
      <div id="disqus_thread"></div>
      <script type="text/javascript">
        window.disqus_identifier="";
        window.disqus_url="http://iaarchiver.github.io/posts/2013-07-08-1730.html";
        window.disqus_title="Ubuntuでmpdのセットアップ";
      </script>
        <script type="text/javascript" src="http://disqus.com/forums/iaarchiver/embed.js"></script>
        <noscript><a href="http://iaarchiver.disqus.com/?url=ref">View the discussion thread.</a></noscript>
    
  </div>
</div>


      <div class="footer">
      Copyright iaarchiver, 2014.
      </div>
    </div>
    <!-- [END] .wrapper -->

    <!-- load JS -->
    <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1/jquery.min.js"></script>
    <script type="text/javascript" src="/scripts.js"></script>
  </body>
</html>
